{"ast":null,"code":"import React,{useEffect,useLayoutEffect,useState}from'react';import'../styles/Room.css';import{getGameRoom,reqGameTurn}from\"../utils/api\";import{useNavigate,useParams}from'react-router-dom';import Cell from\"../components/Room/Cell\";import Final from'../components/Room/Final';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function Room(){var _room$player_field,_room$opponent_field;const[room,setRoom]=useState({id:\"\",name:\"\",turn:\"\",current_turn:\"\",player_field:[],opponent_field:[]});const{id}=useParams();const[final,setFinal]=useState({isFinal:false,final:\"\",id:\"\"});const[waiting,setWaiting]=useState(true);const navigate=useNavigate();let interval;useLayoutEffect(()=>{const fetchData=async()=>{try{const resp=await getGameRoom(id);setRoom(resp);}catch(error){console.error('Ошибка при получении комнаты:',error);clearInterval(interval);navigate('/');}};fetchData();interval=setInterval(fetchData,1000);},[]);useEffect(()=>{if(room){let countOfOpponent=0;let countOfPlayer=0;if(room.current_turn==\"Ваш ход\"){setWaiting(false);}else{setWaiting(true);}console.log(room);if(room.player_field.length<1){return;}for(let x=0;x<100;x++){if(room.opponent_field[x].has_ship&&room.opponent_field[x].is_shot){countOfOpponent++;}if(room.player_field[x].has_ship&&room.player_field[x].is_shot){countOfPlayer++;}}if(countOfOpponent>=16){setFinal({isFinal:true,final:\"Выиграли\",id:id});clearInterval(interval);setWaiting(true);}if(countOfPlayer>=16){setFinal({isFinal:true,final:\"Проиграли\",id:id});clearInterval(interval);setWaiting(true);}}},[room]);const updateTurn=async cell=>{try{if(id){await reqGameTurn(id,cell);const resp=await getGameRoom(id);setRoom(resp);}}catch(error){console.error('Ошибка при получении комнаты:',error);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"room\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"header\",children:/*#__PURE__*/_jsx(\"div\",{className:\"header__roomName\",children:room===null||room===void 0?void 0:room.name})}),/*#__PURE__*/_jsxs(\"div\",{className:\"gameZone\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"field\",children:room===null||room===void 0?void 0:(_room$player_field=room.player_field)===null||_room$player_field===void 0?void 0:_room$player_field.map(cell=>/*#__PURE__*/_jsx(Cell,{cell:cell,my:true,updateTurn:updateTurn,isWaiting:waiting},\"\".concat(cell.x,\"-\").concat(cell.y)))}),/*#__PURE__*/_jsx(\"div\",{className:\"field\",children:room===null||room===void 0?void 0:(_room$opponent_field=room.opponent_field)===null||_room$opponent_field===void 0?void 0:_room$opponent_field.map(cell=>/*#__PURE__*/_jsx(Cell,{cell:cell,my:false,updateTurn:updateTurn,isWaiting:waiting},\"\".concat(cell.x,\"-\").concat(cell.y)))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"info__turn\",children:[\"\\u0425\\u043E\\u0434: \",room===null||room===void 0?void 0:room.turn]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info__turnOwner\",children:[\"\\u0427\\u0435\\u0439 \\u0445\\u043E\\u0434: \",room===null||room===void 0?void 0:room.current_turn]})]}),final.isFinal?/*#__PURE__*/_jsx(Final,{final:final.final,id:final.id}):/*#__PURE__*/_jsx(_Fragment,{})]});}export default Room;","map":{"version":3,"names":["React","useEffect","useLayoutEffect","useState","getGameRoom","reqGameTurn","useNavigate","useParams","Cell","Final","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Room","_room$player_field","_room$opponent_field","room","setRoom","id","name","turn","current_turn","player_field","opponent_field","final","setFinal","isFinal","waiting","setWaiting","navigate","interval","fetchData","resp","error","console","clearInterval","setInterval","countOfOpponent","countOfPlayer","log","length","x","has_ship","is_shot","updateTurn","cell","className","children","map","my","isWaiting","concat","y"],"sources":["C:/Users/user/Desktop/DOCKpushTEST/Front/src/pages/Room.tsx"],"sourcesContent":["import React, {useEffect, useLayoutEffect, useState} from 'react';\r\nimport '../styles/Room.css';\r\nimport { RoomType, RoomMessage, CellType, CellExportType } from '../types/types';\r\nimport {getGameRoom, reqGameTurn} from \"../utils/api\"\r\nimport { useNavigate, useParams } from 'react-router-dom';\r\nimport Cell from \"../components/Room/Cell\"\r\nimport Final from '../components/Room/Final';\r\n\r\nfunction Room() {\r\n    const [room, setRoom] = useState<RoomType>({id: \"\",\r\n  name: \"\",\r\n  turn: \"\",\r\n  current_turn: \"\",\r\n  player_field: [],\r\n  opponent_field: []})\r\n    const { id } = useParams<{ id: string }>();\r\n    const [final, setFinal] = useState<{isFinal: boolean, final: string, id: string}>({isFinal: false, final: \"\", id: \"\"})\r\n    const [waiting, setWaiting] = useState<boolean>(true)\r\n    const navigate = useNavigate();\r\n    let interval:NodeJS.Timer;\r\n\r\n    useLayoutEffect(() => {\r\n        const fetchData = async () => {\r\n            try {\r\n                const resp = await getGameRoom(id!);\r\n                setRoom(resp);\r\n            } catch (error) {\r\n                console.error('Ошибка при получении комнаты:', error);\r\n                clearInterval(interval)\r\n                navigate('/')\r\n            }\r\n        };\r\n        fetchData()\r\n        interval = setInterval(fetchData, 1000)\r\n    }, []); \r\n\r\n    useEffect(() => {\r\n    if (room) {\r\n        let countOfOpponent = 0\r\n        let countOfPlayer = 0\r\n        if(room.current_turn == \"Ваш ход\")\r\n        {\r\n            setWaiting(false)\r\n        }\r\n        else\r\n        {\r\n            setWaiting(true)\r\n        }\r\n        console.log(room)\r\n        if(room.player_field.length < 1)\r\n        {\r\n            return\r\n        }\r\n        for(let x: number = 0; x < 100; x++)\r\n        {\r\n            if(room.opponent_field[x].has_ship && room.opponent_field[x].is_shot)\r\n            {\r\n                countOfOpponent++;\r\n            }\r\n            if(room.player_field[x].has_ship && room.player_field[x].is_shot)\r\n            {\r\n                countOfPlayer++;\r\n            }\r\n        }\r\n        if(countOfOpponent >= 16)\r\n        {\r\n            setFinal({isFinal: true, final: \"Выиграли\", id: id!})\r\n            clearInterval(interval)\r\n            setWaiting(true)\r\n        }\r\n        if(countOfPlayer >= 16)\r\n        {\r\n            setFinal({isFinal: true, final: \"Проиграли\", id: id!})\r\n            clearInterval(interval)    \r\n            setWaiting(true)\r\n        }\r\n    }\r\n    }, [room]);\r\n\r\n    const updateTurn = async (cell: CellType) =>\r\n    {\r\n        try {\r\n            if (id) {\r\n                await reqGameTurn(id, cell);\r\n                const resp = await getGameRoom(id);\r\n                setRoom(resp);\r\n            }\r\n        } catch (error) {\r\n            console.error('Ошибка при получении комнаты:', error);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"room\">\r\n            <div className=\"header\">\r\n                <div className=\"header__roomName\">{room?.name}</div>\r\n            </div>\r\n            <div className=\"gameZone\">\r\n                <div className=\"field\">\r\n                    {room?.player_field?.map((cell: CellType) => (\r\n                        <Cell key={`${cell.x}-${cell.y}`} cell={cell} my={true} updateTurn={updateTurn} isWaiting={waiting}></Cell>\r\n                     ))}\r\n                </div>\r\n                <div className=\"field\">\r\n                     {room?.opponent_field?.map((cell: CellType) => (\r\n                        <Cell key={`${cell.x}-${cell.y}`} cell={cell} my={false} updateTurn={updateTurn} isWaiting={waiting}></Cell>\r\n                     ))}\r\n                </div>\r\n            </div>\r\n            <div className=\"info\">\r\n                <div className=\"info__turn\">Ход: {room?.turn}</div>\r\n                <div className=\"info__turnOwner\">Чей ход: {room?.current_turn}</div>\r\n            </div>\r\n            {final.isFinal ?\r\n            <Final final={final.final} id={final.id}></Final> : <></>\r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Room;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}